import pybullet as p
import math
import numpy as np
import pybullet_data
import time
import bezier
import abc
import serial
import matplotlib.pyplot as plt
import pygame

from deap import base
from deap import creator
from deap import tools
import random
import seaborn as sns
import elitism


# roslaunch urdf_tutorial display.launch model:='D:\Programming\Python\Hexapod-GA-Gait\robot.urdf'
# roslaunch urdf_tutorial display.launch model:='D:\Programming\Python\Hexapod-GA-Gait\crab_description\models\crab_model.urdf'


class Gait:

    def __init__(self, chromosome):
        self.duration = chromosome[0]
        self.motion_chromosome = chromosome[3:]
        self.legSequences = []
        for j in range(6):
            motions = self.motion_chromosome[j * SIZE_OF_MOTION_CHROMOSOME * MAX_MOTIONS_IN_SEQUENCE: (j + 1) * SIZE_OF_MOTION_CHROMOSOME * MAX_MOTIONS_IN_SEQUENCE]
            ls = LegSequence(chromosome[0], j, motions)
            self.legSequences.append(ls)

    def evaluate(self, elapsed_time):
        leg_positions = []
        for ls in self.legSequences:
            leg_positions.append(ls.evaluate((elapsed_time % self.duration) / self.duration))
        return leg_positions


class LegSequence:
    def __init__(self, duration, legID, motion_chromosome):
        self.duration = duration
        self.legID = legID
        # self.motions = self.manualInitMotions(legID)
        self.motions = self.readChromosome(motion_chromosome)
        self.motions.sort(key=lambda x: x[0])
        self.addNoMotionConsts()

    def readChromosome(self, chromosome):
        motions = []
        for ii in range(MAX_MOTIONS_IN_SEQUENCE):
            local_index = ii * SIZE_OF_MOTION_CHROMOSOME
            motion_type = round(chromosome[0 + local_index])
            start_time = chromosome[1 + local_index]
            if motion_type == 0:
                continue
            elif motion_type == 1:  # line motions
                motions.append((start_time, LineMotion([chromosome[6 + local_index], chromosome[7 + local_index], chromosome[8 + local_index]],
                                                       [chromosome[15 + local_index], chromosome[16 + local_index], chromosome[17 + local_index]],
                                                       np.array([[0.0, chromosome[2 + local_index], chromosome[4 + local_index], 1.0],
                                                                 [0.0, chromosome[3 + local_index], chromosome[5 + local_index], 1.0]]))))
            elif motion_type == 2:  # curve motions
                motions.append((start_time,
                                BezierMotion(np.array([[chromosome[6 + local_index], chromosome[9 + local_index], chromosome[12 + local_index], chromosome[15 + local_index]],
                                                       [chromosome[7 + local_index], chromosome[10 + local_index], chromosome[13 + local_index], chromosome[16 + local_index]],
                                                       [chromosome[8 + local_index], chromosome[11 + local_index], chromosome[14 + local_index], chromosome[17 + local_index]]]),
                                             np.array([[0.0, chromosome[2 + local_index], chromosome[4 + local_index], 1.0], [0.0, chromosome[3 + local_index], chromosome[5 + local_index], 1.0]]))))
            elif motion_type == 4:
                motions.append((start_time, NoMotion()))
        return motions

    def manualInitMotions(self, legID):
        startPos = [0.0, -0.5, 0.0]
        knot1 = [0.0, 0.0, 0.6]
        knot2 = [0.0, 0.5, 0.6]
        endPos = [0.0, 0.5, 0.0]
        motions = []
        if legID % 2:
            motions.append((0.0, BezierMotion(np.array([[startPos[0], knot1[0], knot2[0], endPos[0]], [startPos[1], knot1[1], knot2[1], endPos[1]], [startPos[2], knot1[2], knot2[2], endPos[2]]]))))
            motions.append((0.5, LineMotion(endPos, startPos)))
        else:
            motions.append((0.0, LineMotion(endPos, startPos)))
            motions.append((0.5, BezierMotion(np.array([[startPos[0], knot1[0], knot2[0], endPos[0]], [startPos[1], knot1[1], knot2[1], endPos[1]], [startPos[2], knot1[2], knot2[2], endPos[2]]]))))
        return motions

    def addNoMotionConsts(self):
        if len(self.motions) > 1:
            for j in range(len(self.motions)):
                if type(self.motions[j][1]) is NoMotion:
                    self.motions[j][1].setEvaluationConst(self.motions[(j - 1) % (len(self.motions))][1].evaluate(1.0))

    def getPositionInMotion(self, progress, motions):
        # for-loop to loop around every motion to return motion for a given amount of progress
        for j in range(len(motions) - 1, -1, -1):
            # print(f'j: {j}')
            motion_start_time = motions[j][0]
            end_time = motions[(j + 1) % (len(motions))][0]
            loop_back = (motion_start_time >= end_time)
            if progress < end_time and loop_back:
                progress += 1
            end_time += loop_back  # end of cycle motion loop back around
            if motion_start_time <= progress < end_time:
                # Convert global progress into local-progress of given motion
                local_progress = (progress - motion_start_time) / (end_time - motion_start_time)
                return motions[j][1].evaluate(local_progress)

        return [0.0, 0.0, 0.0]

    def evaluate(self, progress):
        return self.getPositionInMotion(progress, self.motions)


class Motion(metaclass=abc.ABCMeta):
    @abc.abstractmethod
    def evaluate(self, progress):
        pass


class BezierMotion(Motion):
    def __init__(self, knots, velocity_knots):
        self.knots = knots
        self.curve = bezier.Curve(self.knots, degree=3)
        self.velocity_curve = bezier.Curve(velocity_knots, degree=3)
        # plotCurve(self.velocity_curve)

    def evaluate(self, progress):
        # velocity curve: y=a+\frac{b}{\left(sx+1\right)^{7}}
        # progress = 1 + -(1 / math.pow((progress + 1), 7))
        curved_progress = self.velocity_curve.evaluate(progress)
        raw_position = self.curve.evaluate(curved_progress[1][0] % 1)
        position = flatten(raw_position)
        return position


class LineMotion(Motion):
    def __init__(self, startPoint, endPoint, velocity_knots):
        self.startPoint = startPoint
        self.endPoint = endPoint
        self.velocity_curve = bezier.Curve(velocity_knots, degree=3)
        # plotCurve(self.velocity_curve)

    # Parametric equation of a straight line given a progression percentage
    def evaluate(self, progress):
        # velocity curve: y=a+\frac{b}{\left(sx+1\right)^{7}}
        # progress = 1 + -(1 / math.pow((progress + 1), 7))

        curved_progress = self.velocity_curve.evaluate(progress % 1)
        x = self.startPoint[0] + (self.endPoint[0] - self.startPoint[0]) * curved_progress[1][0]
        y = self.startPoint[1] + (self.endPoint[1] - self.startPoint[1]) * curved_progress[1][0]
        z = self.startPoint[2] + (self.endPoint[2] - self.startPoint[2]) * curved_progress[1][0]
        return [x, y, z]


class NoMotion(Motion):
    def __init__(self, *args):
        self.evaluationConst = [0.0, 0.0, 0.0]
        if len(args) == 1:
            self.evaluationConst = args[0]

    def setEvaluationConst(self, c):
        self.evaluationConst = c

    def evaluate(self, progress):
        return self.evaluationConst


def radToPwm(angle):
    return ((2000 * angle) / math.pi) + 1500


# t in ms; the closer t is to 0, more accuracy but less smooth motion
def updateRealServos(ser, t):
    # right legs
    ser.write(
        f'#0P{radToPwm(-p.getJointState(hexapod_ID, 8)[0])}T{t}#1P{radToPwm(p.getJointState(hexapod_ID, 9)[0])}T{t}#2P{radToPwm(-p.getJointState(hexapod_ID, 10)[0])}T{t}\r'.encode(
            'utf-8'))
    ser.write(
        f'#4P{radToPwm(-p.getJointState(hexapod_ID, 4)[0])}T{t}#5P{radToPwm(p.getJointState(hexapod_ID, 5)[0])}T{t}#6P{radToPwm(-p.getJointState(hexapod_ID, 6)[0])}T{t}\r'.encode(
            'utf-8'))
    ser.write(
        f'#8P{radToPwm(-p.getJointState(hexapod_ID, 0)[0])}T{t}#9P{radToPwm(p.getJointState(hexapod_ID, 1)[0])}T{t}#10P{radToPwm(-p.getJointState(hexapod_ID, 2)[0])}T{t}\r'.encode(
            'utf-8'))

    # left legs
    ser.write(
        f'#24P{radToPwm(-p.getJointState(hexapod_ID, 12)[0])}T{t}#25P{radToPwm(p.getJointState(hexapod_ID, 13)[0])}T{t}#26P{radToPwm(-p.getJointState(hexapod_ID, 14)[0])}T{t}\r'.encode(
            'utf-8'))
    ser.write(
        f'#20P{radToPwm(-p.getJointState(hexapod_ID, 16)[0])}T{t}#21P{radToPwm(p.getJointState(hexapod_ID, 17)[0])}T{t}#22P{radToPwm(-p.getJointState(hexapod_ID, 18)[0])}T{t}\r'.encode(
            'utf-8'))
    ser.write(
        f'#16P{radToPwm(-p.getJointState(hexapod_ID, 20)[0])}T{t}#17P{radToPwm(p.getJointState(hexapod_ID, 21)[0])}T{t}#18P{radToPwm(-p.getJointState(hexapod_ID, 22)[0])}T{t}\r'.encode(
            'utf-8'))


def calculateIK3(feet_positions, jointDamping):
    pos_body = np.array(p.getBasePositionAndOrientation(hexapod_ID)[0])
    orn_body = p.getBasePositionAndOrientation(hexapod_ID)[1]

    rest_poses = []
    local_target_pos = []
    translated_pos = []
    target_pos = []

    for j in range(6):
        rest_poses.append(pos_body + p.multiplyTransforms([0, 0, 0], orn_body, baseToEndEffectorConstVec[j], [0, 0, 0, 1])[0])
        local_target_pos.append(feet_positions[j])
        translated_pos.append(p.multiplyTransforms(rest_poses[j], orn_body, local_target_pos[j], [0, 0, 0, 1]))
        target_pos.append(translated_pos[j][0])

    ik = p.calculateInverseKinematics2(
        hexapod_ID,
        ([x for x in range(3, 24, 4)]),
        target_pos,
        solver=p.IK_DLS,
        lowerLimits=ll,
        upperLimits=ul,
        jointRanges=jr,
        restPoses=rest_poses,
        jointDamping=([jointDamping] * 18)
    )
    return ik


def setServoStatesManual():
    p.setJointMotorControlArray(
        hexapod_ID,
        JOINT_INDICES,
        p.POSITION_CONTROL)
    # targetPositions=read_debug_parameters())


def setServoStatesLegs(feet_positions, force, jointDamping):
    p.setJointMotorControlArray(
        hexapod_ID,
        JOINT_INDICES,
        p.POSITION_CONTROL,
        targetPositions=calculateIK3(feet_positions, jointDamping),
        forces=([force] * 18)
    )


def plotCurve(bezier_curve):
    bezier_curve.plot(num_pts=256)


def flatten(t):
    return [item for sublist in t for item in sublist]


def manualChromosomeCreation():
    duration = 2
    force = 150
    jointDamping = 0
    chromosome = [duration, force, jointDamping]
    bezierMotion = [2, 0.0, 0.5, 0.5, 0.5, 0.5, 0.0, -0.5, 0.0, 0.0, 0.0, 0.6, 0.0, 0.5, 0.6, 0.0, 0.5, 0.0]
    lineMotion = [1, 0.5, 1.0, 0.0, 1.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.5, 0.0]
    for leg_id in range(NUM_OF_LEGS):
        if leg_id % 2 == 0:
            bezierMotion[1] = 0.0
            lineMotion[1] = 0.5
        else:
            bezierMotion[1] = 0.5
            lineMotion[1] = 0.0
        chromosome.extend(bezierMotion)
        chromosome.extend(lineMotion)
        for motion_id in range(MAX_MOTIONS_IN_SEQUENCE - 2):
            chromosome.extend([0] * SIZE_OF_MOTION_CHROMOSOME)
    # print(chromosome)
    return chromosome


def gaitScore(bodyID):
    current_position = p.getBasePositionAndOrientation(bodyID)[0]
    distance = distanceFromOrigin(bodyID)
    angle = angleBetweenVectors(np.array([0, 1]), np.array([current_position[0], current_position[1]]))
    return distance, abs(angle)


def distanceFromOrigin(bodyID):
    return p.getBasePositionAndOrientation(bodyID)[0][1]


def angleBetweenVectors(a, b):
    unit_vector_1 = a / np.linalg.norm(a)
    unit_vector_2 = b / np.linalg.norm(b)
    dot_product = np.dot(unit_vector_1, unit_vector_2)
    angle = np.arccos(dot_product)
    return angle


def evaluateGait(individual):
    lastTime = time.time()
    dt = 0
    gait = Gait(individual)
    resetEnvironment()
    while math.isnan(distanceFromOrigin(hexapod_ID)):
        resetEnvironment()
    for ii in range(3000):
        dt += 1. / 240.
        setServoStatesLegs(gait.evaluate(dt), individual[1], 0)
        p.stepSimulation()
    gaitEvaluation = gaitScore(hexapod_ID)
    print(f'Time Elapsed: {time.time() - lastTime} seconds')
    print(f'Evaluation: {gaitEvaluation}')
    print(f'Chromosome: {individual}')
    return gaitEvaluation


def runGait(individual):
    lastTime = time.time()
    gait = Gait(individual)
    resetLegJoints()
    p.resetBasePositionAndOrientation(hexapod_ID, [0, 0, 1.5], [0, 0, 0, 1])
    p.setRealTimeSimulation(1)
    for ii in range(100000):
        setServoStatesLegs(gait.evaluate(time.time() - programStartTime), individual[1], 0)
        p.setRealTimeSimulation(1)

    gaitEvaluation = gaitScore(hexapod_ID)
    print(f'Time Elapsed: {time.time() - lastTime} seconds')
    print(f'Evaluation: {gaitScore(hexapod_ID)}')
    print(f'Chromosome: {individual}')
    return gaitEvaluation


def resetLegJoints():
    p.resetJointStatesMultiDof(hexapod_ID, JOINT_INDICES, [[0]] * 18, targetVelocities=[[0]] * 18)
    p.setJointMotorControlArray(hexapod_ID, JOINT_INDICES, p.POSITION_CONTROL, targetPositions=([0] * 18), forces=([150] * 18))


def resetEnvironment():
    resetLegJoints()
    p.resetBasePositionAndOrientation(hexapod_ID, [0, 0, 1.375], [0, 0, 0, 1])
    p.resetBasePositionAndOrientation(plane_ID, [0, 0, 0], [0, 0, 0, 1])
    p.stepSimulation()


# start of main program
MAX_MOTIONS_IN_SEQUENCE = 4
NUM_OF_LEGS = 6
SIZE_OF_MOTION_CHROMOSOME = 18

physicsClient = p.connect(p.GUI)
p.setAdditionalSearchPath(pybullet_data.getDataPath())
p.setGravity(0, 0, -9.8)
plane_ID = p.loadURDF("plane.urdf")
hexapod_ID = p.loadURDF("robot2.urdf", [0, 0, 1.375], [0, 0, 0, 1])

servoRangeOfMotion = math.pi * 3 / 4

# setup IK parameters
ll = ([-servoRangeOfMotion] * 3) + ([0] * 15)  # lowerLimit
ul = ([servoRangeOfMotion] * 3) + ([0] * 15)  # upperLimit
jr = ([servoRangeOfMotion] * 3) + ([0] * 15)  # jointRange
jd = ([0] * 18)  # jointDamping

JOINT_INDICES = [x for x in range(0, 24) if (x + 1) % 4 != 0]

baseToEndEffectorConstVec = []
for i in range(3, 24, 4):
    baseToEndEffectorConstVec.append(
        np.array(p.getLinkState(hexapod_ID, i)[4]) - np.array(p.getBasePositionAndOrientation(hexapod_ID)[0]))

prevPos = []
currentPos = [0, 0, 0, 0, 0, 0]
for i in range(6):
    prevPos.append(p.getLinkState(hexapod_ID, (4 * i) + 3)[0])

programStartTime = time.time()

# PySerial init
# ssc32 = serial.Serial('COM5', 115200, timeout=5)  # open serial port

# GENETIC ALGORITHM MAIN PROGRAM START
DIMENSIONS = 3 + (SIZE_OF_MOTION_CHROMOSOME * MAX_MOTIONS_IN_SEQUENCE * NUM_OF_LEGS)  # number of dimensions
BOUNDS_LOW = [0.1, 50, 0] + ((([0] * 6) + ([-2] * 12)) * 4 * 6)
BOUNDS_HIGH = [12, 300, 1] + (([4] + [1] + ([1] * 4) + ([2] * 12)) * 4 * 6)
# boundIndividual = manualChromosomeCreation()
# BOUNDS_TOLERANCE_LOW = [-0.5, -20, -0.5] + ((([-0.1] * 2) + ([0] * 3) + [-0.1] + ([-0.25] * 12)) * 4 * 6)
# BOUNDS_TOLERANCE_HIGH = [0.5, 50, 0.5] + ((([0.1] * 2) + ([0.5] * 3) + [0] + ([0.25] * 12)) * 4 * 6)
# BOUNDS_LOW = [ind + tol for ind, tol in zip(boundIndividual, BOUNDS_TOLERANCE_LOW)]
# BOUNDS_HIGH = [ind + tol for ind, tol in zip(boundIndividual, BOUNDS_TOLERANCE_HIGH)]

POPULATION_SIZE = 50
P_CROSSOVER = 0.9  # probability for crossover
P_MUTATION = 0.5  # (try also 0.5) probability for mutating an individual
MAX_GENERATIONS = 100
HALL_OF_FAME_SIZE = int((1. / 10.) * POPULATION_SIZE)
CROWDING_FACTOR = 10.0  # crowding factor for crossover and mutation
# RANDOM_SEED = 42
# random.seed(RANDOM_SEED)
toolbox = base.Toolbox()
creator.create("FitnessMax", base.Fitness, weights=(1.0, -0.5))
creator.create("Individual", list, fitness=creator.FitnessMax)

for i in range(DIMENSIONS):
    toolbox.register("layer_size_attribute_" + str(i), random.uniform, BOUNDS_LOW[i], BOUNDS_HIGH[i])

layer_size_attributes = ()
for i in range(DIMENSIONS):
    layer_size_attributes = layer_size_attributes + \
                            (toolbox.__getattribute__("layer_size_attribute_" + str(i)),)

toolbox.register("individualCreator", tools.initCycle, creator.Individual, layer_size_attributes, n=1)
toolbox.register("populationCreator", tools.initRepeat, list, toolbox.individualCreator)
toolbox.register("evaluate", evaluateGait)
toolbox.register("select", tools.selTournament, tournsize=2)
toolbox.register("mate", tools.cxSimulatedBinaryBounded, low=BOUNDS_LOW, up=BOUNDS_HIGH, eta=CROWDING_FACTOR)
toolbox.register("mutate", tools.mutPolynomialBounded, low=BOUNDS_LOW, up=BOUNDS_HIGH, eta=CROWDING_FACTOR, indpb=2.0 / 100.0)


# runGait([0.3929596408986611, 271.5139665796697, 0.02179784665106128, 1.8532968830347771, 0.8492462918927379, 0.554534014911483, 0.9096399675609805, 0.8631464614091577, 0.6489863769729364, -0.6770792952290772, -1.2024231662364053, -1.4226953255473451, 1.5657287040645171, 1.6053243429456732, -1.6189544370735007, 0.6260921241798696, -0.0980919955334536, 0.31259701595971506, 0.9099843049743708, -1.6152187666737388, 1.6704164849841168, 1.9912046865957305, 0.8293674927890938, 0.85144903837633, 0.685185310139843, 0.6545103596275429, 0.6079054070042292, 1.1102074278084582, 0.693180338561957, -0.6042208051945435, -0.1429678912184978, 1.3093902668780204, 0.2596078010020837, -1.0879051795955774, 1.347018982021124, 1.78843469217256, -0.7073890471863828, 0.3236779127527265, 0.3828557829603574, 2.252213853759304, 0.7013671641009545, 0.17332385418997887, 0.6435254405550995, 0.7997974932236792, 0.5231552215113654, 0.9598199597506072, -1.6473612477844062, -0.35485016116272605, -1.547468916231787, 1.1620927241868553, -0.5478712815764192, -1.1273764231357206, 0.3320558180508577, 1.721401666493682, 0.976388555863589, 1.2473911660001924, -1.6446123951381832, 2.021160098856527, 0.09718775551726816, 0.342321509565681, 0.8529443037095106, 0.4547096450553581, 0.10829293371628797, 1.6866469184200623, -0.8774585545705775, 1.6533657496898324, -0.1314966141139049, -0.4687640805871074, -0.12449864464414281, 0.4047860500294303, 0.1980606696116589, -1.9006493114912426, -0.053924610714671584, 0.057224826109606663, -1.6053992664376846, 2.3444318274374107, 0.03903633256930199, 0.1833346391599111, 0.7362259000311269, 0.34008815606961723, 0.784035644564481, -0.14384890113589843, -0.9144711237507601, -0.7199610080510607, -1.069476235764114, 1.2804900985689844, 1.5159115631098559, -1.2922936539054901, -0.25878588389995005, 1.2721950360813858, 1.7535510141358024, -0.3825454048992485, 0.3433487504761775, 0.23580375481731908, 0.22751392580364121, 0.6407101139434426, 0.5525495045034661, 0.9183703476020562, 0.6027091138539926, -0.4146489413542124, -1.4959212145427974, -1.6996182449739472, 0.6873943613705121, -1.0211800013055639, 0.20728570130698842, -1.1309601490370387, -1.4650249819934855, 0.38757094348841814, 1.941472984007417, -1.92075169833105, 0.3096858785793627, 2.6462405817117554, 0.9466329014243898, 0.903643718935992, 0.6773134123483033, 0.3811245612529034, 0.12675146346463406, -1.2448182806759776, 1.2096950959181225, 0.5113006133444072, -0.1595925161915645, 0.4003195762924433, -1.7631801159916058, -0.001974859232783621, -0.11568610269787594, -0.7093572453746229, 0.5774012333639004, -0.8391696865875383, 1.017665452010056, 1.4473452121283188, 0.9202466508303866, 0.9536566309588177, 0.9664047348193652, 0.008340561840553429, 0.414557747893876, -1.615962731390875, -0.9615336788676241, -1.1342411575439386, -1.0700100378285649, 1.602416940477214, 1.624120102319282, 1.7518527501908585, 0.2824915276107984, 1.818405036333659, 1.2390320920728766, -0.1539677572471415, 0.45802462406491806, 0.2475461448573706, 0.43629885406398805, 0.5062440885751975, 0.7825837031373583, 0.8442766436188887, 0.9157499757058284, 0.3255211548184844, 1.228161858640401, 0.8297688863125858, 1.5227117309284082, -1.2543146836505394, -1.1167265202219159, 0.47909607697266604, 1.307869100384197, -1.0971817030582358, 0.7482676035545444, 0.671932249611473, 1.7729935231123681, 3.608296250343415, 0.952381984331194, 0.2932667880088783, 0.5309172641119879, 0.55448540993255, 0.38533252365175774, 1.4661541548932577, 1.2489349067127273, -0.7467690121128916, -0.40027519479373797, 1.3243321900767535, -0.6723634093773918, 1.9814534805633683, 1.7409267900795382, 0.8869268636428124, 1.5501896463732656, -1.2238882789583938, -0.44070502211271656, 2.1920493218413974, 0.9922850450201985, 0.9822075695010913, 0.04266402383640954, 0.9377092756637283, 0.8217392315248615, -0.6477506438838935, 0.055280003442610526, -1.6905709010231098, -1.2205038058814357, 1.4518107831562812, -1.6861948132741114, -0.6152754461688411, -0.3439722733987532, -1.8988477066435918, 0.6547229650311512, -1.3423875521358304, -0.6932045874706789, 1.269712966268086, 0.8057572340331309, 0.4439861727164672, 0.579184054886488, 0.06097794021019726, 0.5650574090541826, -0.3671711294104478, -0.07430270211761256, 1.3127926184109424, 1.7231470720469317, 0.10705487627913679, -1.0480030946666614, 0.6738173967857991, -0.29320656893164704, 0.7507463678674542, -0.9187410127951625, 1.4621875567553182, 1.978293825827143, 1.633043242687323, 0.5238715280009296, 0.5510864512407156, 0.6298485398823238, 0.12329690693412618, 0.3574057066001546, 1.5121851034858746, -0.35322969925409237, 1.301202634262455, 0.9867591550353965, 0.6115930296640109, -0.3963092535140088, 1.0547972961115355, 1.6474974632182078, -1.340427209143473, -1.3678032685907149, 1.3359237469579208, 1.059120759571917, 0.2478740111553388, 0.18617914200794616, 0.34774147385197063, 0.9348721647034101, 0.022999636044332375, 0.5440694273652704, 1.142217272891032, -1.8268417232099434, 0.031158754270179778, 0.8557715692686951, 1.0620473277031184, 0.000781513920318111, 0.3774494776234629, 0.6883462770678597, 0.8553326752447223, -0.367292638210583, -1.6457276932902936, 0.46482514644250394, 3.3183311964115507, 0.3234406510872574, 0.6441937462588783, 0.71620964712244, 0.5536819957194653, 0.8834587614147069, -0.12673080251551472, -0.3130162857562026, -0.46818509737169034, 0.8949755307460807, -1.2078289897367571, -0.895549918287196, -0.8799608578311111, -1.9623666496328824, 1.895533284630842, -1.4597254841407006, 1.4872971753141186, -0.9264001515965674, 0.305867274285466, 0.2179968955646554, 0.09087440155108728, 0.38313039487973344, 0.7142409603228854, 0.5450618601973616, -0.849398771599963, -1.5604475327236265, 1.4356067373248453, 1.6578365644937574, 0.755073710441031, 0.8868534941748853, -0.9942927627329854, 1.6976773925601096, -1.4700834983422162, 1.8836021413427277, -0.4188204440877618, 1.5543520521783374, 1.3620656907557127, 0.001409600301766012, 0.487037262545826, 0.5822703183642449, 0.7929970789537821, 0.12475752635864557, 0.06587321106771649, 1.0089069399029411, 0.7638243102515021, 0.9224877032551977, -0.7319715118847039, -1.1456269197609994, -0.08415890459020081, -1.5198429485705252, 1.2059669990465576, 0.35595148266461263, 0.09613387285368162, 1.7447344493332273, 1.5862874715237112, 0.10054264234647436, 0.2541306357086999, 0.2334000566335393, 0.2117136127542236, 0.7303932244444657, -0.8245185043747635, -0.44842004243410694, -0.924383430130398, 1.4272601121994766, 1.6099170062995323, -0.7460859809757812, -0.4852596340179135, -1.2359970483211054, -1.148441654857184, 1.9995408770178726, -0.37980152788637084, 1.374234934177405, 2.09017258141923, 0.7369367400533136, 0.9098831729429618, 0.1460775580432107, 0.5544035221523244, 0.4745493003837572, -0.6368630843743155, -0.5513448018168514, 0.0750392707095453, 0.7940426936327051, -0.7676076770396696, 0.5104991209663619, -1.6304023802706158, -1.2916141820794969, 1.0711892367943634, 0.3898807116562596, 1.6922124127961888, -0.13864290425980405, 2.967551595489912, 0.3307299758510207, 0.30941510168215935, 0.598195505864068, 0.5646352813873388, 0.852973608530323, -0.463631446810841, -0.944595308418752, -1.3125606053813108, -0.10123363438610405, -1.9409118349571859, 1.6453736989618446, -1.7713506607149667, 0.0020045904273217063, -1.818144202073888, -1.2541158356297104, 0.4299744064157397, 1.8434868688859585, 3.8180546251873335, 0.6093106416224519, 0.9644979988287212, 0.8602117694676918, 0.8123880835284422, 0.6842880973295431, -0.13954566121656675, -1.8167642927060814, 0.8160045767363266, -1.6346102891436372, -1.6352284399388584, -1.4635869399233195, -1.951822728521103, 0.6546852340806124, -1.1111091587792277, 1.2652769269100803, -1.7116500890281419, 1.3447345251930551, 2.4384087309721534, 0.7207894027245089, 0.13732216695963748, 0.9790471956095228, 0.8878870782294243, 0.7362554825070255, 0.6142832916290202, -0.25260991833107327, 0.7332820363129144, -1.7923870552386652, 1.127810613771877, 0.13424348815955411, 1.1637015509111794, -1.548506570304124, -1.3250801203618767, -0.3996992285618115, -1.062571699252071, 1.7818023065305537, 1.2229067952273753, 0.2559430728821008, 0.6446833295504868, 0.4955503284206849, 0.6613993965651008, 0.10098293246158996, 1.0603371211112682, -0.364910936751766, 0.5510804747786805, 1.7817029673797768, 1.1083710283746402, -0.03838355352174139, 0.29480572186152687, 0.9164264658960328, 0.384329151282344, -0.053652679418499424, -0.5227425488481761, -0.9535315704072886, 2.1197526630618477, 0.8865058803694138, 0.6770665352299008, 0.7586376652838565, 0.9191708493671651, 0.1632821757662415, 1.2741038247130931, 1.6943840823275909, -1.321038432867731, 0.1181301473346546, -1.7809059537385103, -0.7291821244963348, -0.6413524267992272, 0.235948423525494, 1.5634383061782673, -1.6810692186976162, -1.205659319594056, -1.5492788934625252])
# runGait([1.661410548927439, 174.8348188525659, 0.3693813923703286, 2.0608112754002033, 0.07538509537142724, 0.7416871676487358, 0.9854485037954701, 0.5265001862435248, 0.4546251481825753, -0.13900138777360854, -0.6127274443650863, -0.014884850450367092, 0.17698480097351454, -0.13486852662277926, 0.7879438338654373, 0.20831515167941375, 0.5995702477322808, 0.762857068329974, -0.2430094360656872, 0.3886414263938246, -0.24414518714792538, 0.9427314733104668, 0.5947974511493522, 1.2696317055497575, 0.3497680730102215, 1.2398505482893116, -0.05664198664974168, -0.20911252169690758, 0.26539536653456136, 0.03672473582406422, -0.028027138885947392, -0.07946537548782913, 0.21834982446638193, -0.17381950436648885, -0.2143187693154934, -0.010443907867038527, 0.19720101923077896, -0.512512553136595, 0.1910155104424463, -0.01935610645013957, -2.8425352840124197e-05, 0.3492777705108681, 0.3747323973485637, 0.25715742742770986, -0.013403174987307895, -0.004405073968874601, 0.09593094988618704, -0.03905304529783965, -0.2218310182718091, -0.06752942764312195, 0.039587824945942915, 0.13524218607308064, 0.006621455992166923, 0.09680401945503848, -0.030489108483147925, 0.10931572658400346, 0.24570002199071447, -0.0007158183672126769, 0.01662926491894831, 0.4094490127769305, 0.3958682950354418, 0.21695408324099888, -0.03746832221460537, 0.17846564644439356, -0.209344046020411, 0.0904463951829241, -0.0167489807781267, 0.10147290293600668, -0.01031778077136182, -0.21521573653666165, -0.06275269317207338, -0.08579625631884903, -0.24355359875262536, -0.1467026179473066, -0.0737457990549121, 1.955151578336484, 0.44739688030728714, 0.9607392522219972, 0.6318540294747583, 0.9032161253125036, 0.49491685669439783, -0.09241450874575116, -0.3196191394378836, -0.13890691837923164, -0.061477558969128196, 0.17026108191912212, 0.4021439070718635, 0.11845629191298557, 0.47744124482824807, 0.6781724428071096, -0.008026410239027969, 0.7473754486481549, -0.021359051177337277, 1.0901998310126375, 0.012296709285384826, 1.2209519431282558, 0.16314641375625702, 1.1605466747889541, -0.09575129384747132, 0.02648233094643454, 0.5954631198722449, 0.24374212339784027, 0.05743430421786577, 0.19392799709380817, -0.22428433786339053, 0.016408986327925083, -0.17267638190750548, -0.08237185701078523, 0.04037016504294648, -0.4585440690039753, -0.14400167387206542, 0.08277643598888011, -0.09559425768355484, 0.4917525899733563, 0.25345999948169906, 0.35423075104474877, -0.017994544078703684, 0.11219220989806519, 0.20170636346390375, -0.1998931679046796, 0.00507001548912292, -0.053485676218756995, -0.07682821376724851, -0.08904730926720945, 0.028598061984045353, 0.2012710593906268, 0.17803336620242516, -0.1579698342338367, 0.15628123154226037, -0.08732752308115069, -0.042192357366371606, 0.1398150356071572, 0.11821742774662772, 0.25313773102229736, -0.035818153957876894, 0.20889335231531098, 0.007366330904179139, -0.10915067026509168, 0.0692215325481503, -0.14728512954280498, 0.05572784684581488, -0.14912474948862595, -0.0004931763629884636, -0.13234971589145295, 0.0094165531147639, 0.013747903781127169, -0.15159041620364394, 1.9730120818841292, -0.07420708964394471, 0.6975502026931769, 0.6491856818099015, 0.5092372285424811, 0.427393207360251, 0.0028085066864282915, -0.7329403138058799, -0.050089253317895474, -0.030379532565156457, -0.15251622966846662, 0.703674474875121, -0.023095315995053017, 0.41822121962852205, 0.6362407886229052, -0.09313233266636659, 0.5998693869306111, 0.0024680762437297443, 0.9993704763401334, 0.533028651481092, 1.1175145739393009, 0.45308119933718566, 1.4894915407441673, -0.053987277956837734, -0.13924482341601818, 0.5808804632810894, 0.2212584361638751, 0.06874887376461435, 0.0907372671002266, -0.06216423849129545, 0.1822016105101576, -0.13289179409431096, -0.19007774696062907, -0.05953677541116424, -0.589117877299261, -0.21196150507713818, 0.0126000201531362, 0.08254185586222046, 0.22838750277660627, 0.4224859242664401, 0.1440023656271328, -0.02760834024827417, -0.16721348135756733, -0.13836378538482305, 0.03654879695853624, 0.16719065234394742, -0.05292492672441327, -0.15553814509952274, 0.08426587891526618, -0.1395546123776753, 0.2275035191612312, -0.21813424287996194, -0.10189863576719058, 0.06436734977843597, 0.008932720326159257, 0.05038988733196063, 0.2580908423809675, 0.2827175323310935, 0.3602693808750661, -0.06082032614527782, -0.05344776523062569, -0.08096510646426472, 0.10011339133858324, -0.029996970021593204, -0.15176277225900636, 0.2032604568906788, -0.21565026993948272, 0.1584994274400069, 0.2145177601473665, -0.1799440473599721, -0.13356895763359702, -0.04028366838617215, 1.9462742715535326, 0.4823590363648151, 0.8768405118433474, 0.9189991889631531, 0.5468074148563952, 0.42546707021592217, -0.24908876722316353, -0.25380386274514033, 0.12690785058602486, -0.2163643821734352, 0.046319545366684874, 0.4199069872184493, 0.011815091131239824, 0.4168692913322438, 0.8443092929189604, 0.1744346973274981, 0.6710449414034901, 0.12499869570678271, 1.031005997980723, -0.0037734828255076127, 1.2418018312231769, 0.19044779894742841, 1.3674832169499265, -0.060810560706311995, -0.24747092867280654, 0.3755704430289737, 0.022894859788521016, 0.08076778913387621, 0.04720636277914195, -0.19183162805662335, 0.04839677668206485, -0.1832666727178753, 0.11265761895779203, -0.017234377561656956, -0.5878117780549036, -0.006909156827876468, 0.08138797882641732, 0.051957954038194115, 0.014700549343191484, 0.09086410394276143, 0.4057021429866751, -0.04566345679867178, -0.10390484969861237, -0.013470254200921211, 0.1256550555785716, 0.1838450694963879, 0.2407102404103006, 0.19601766710445853, 0.13545195438447846, 0.1301935371826535, -0.09536660392572223, -0.01721058139438225, -0.0036394741333510283, -0.09803419338624281, -0.06991889436535252, 0.024760114237288675, 0.3862003741606692, 0.17031120542521597, 0.3315328240021142, -0.04768988891400364, -0.13413390205672462, 0.037773381520374724, 0.02283121570860107, -0.14645716589454183, -0.02467025002222657, -0.13395505497665422, 0.0793208949948927, 0.21961144776244163, 0.017698548224532436, -0.06514331302928145, 0.1079350011545234, 0.11637514981045913, 2.029156811013954, 0.0026043759770033653, 0.6735401053895467, 0.9827723396082034, 0.9644904086049362, 0.42387645061765816, 0.17738109980563485, -0.7036493529046719, -0.08533600344667722, 0.14340038292875562, 0.24620219738589674, 0.8324067831702403, -0.10002908584343213, 0.460983151744163, 0.8451864348790763, -0.009606669581631458, 0.489331699548764, -0.16629137867866967, 1.0055630085515967, 0.44178077225722, 1.207490756903433, 0.05296853495639779, 1.1920764484359465, -0.03792921191940374, 0.16804901892099605, 0.7271924244991488, 0.026760832944731805, -0.20653910345595572, 0.010171281839738295, 0.09373941335412078, -0.08814029570883841, -0.23020500264716962, -0.05454526264892923, 0.20768190581373433, -0.7040491886254198, -0.09105514422222119, -0.051497371427713434, 0.0725055127116771, 0.09689129230177093, 0.4282310072821922, 0.11311159974990774, -0.07030151691749731, 0.13793767205047802, -0.1365449064268202, -0.0012700489334589973, -0.07172675946863455, -0.037127986601467156, 0.16000815844020172, 0.07143198672356828, 0.021790349623506657, 0.06412725115150208, 0.231446760522161, -0.1277877116703596, -0.23566386923721583, 0.011174251469660931, -0.06144601946760513, 0.3561881887633167, 0.14668556421223922, 0.3785304320866327, -0.06579431638363825, 0.23127149127454585, 0.1075439746615595, -0.15385338290259132, -0.0032218560349236026, -0.248027812644182, -0.10159457991993202, 0.13693929274565478, 0.08904246807501465, 0.09157091670167847, -0.2395667034133096, 0.2024617542315227, 0.1705926997561773, 1.9755562199421983, 0.4294650307745157, 0.5852991458356497, 0.8274460235972142, 0.6406692687813746, 0.46969306116886184, 0.1780754236025223, -0.6384900377111318, -0.04203164390086468, -0.045922539554538476, 0.1394491981930711, 0.7231598434786627, 0.08829326625673871, 0.5239942107243258, 0.5404379705027664, -0.047307814783547814, 0.7278568223962606, 0.12160297047876995, 1.01761016130539, 0.06509632456138943, 1.1425122650264057, 0.1362923636528964, 1.4247929277204883, -0.07885047118890488, -0.14193436754960043, 0.25136135981794355, -0.04761119632776781, 0.17666167025105467, 0.04748582053584735, 0.15365817968004836, -0.14885805774125552, -0.16223116794623174, 0.00834241730116786, -0.087697311226682, -0.5261379765520849, -0.09292287028252683, -0.02372256080872806, -0.030288690375398823, 0.4303213966425173, 0.3780700755350472, 0.19200468254369596, -0.0905505125268281, -0.19403757304002733, 0.15489826415227825, -0.03294921264990435, -0.1707959147272178, 0.13470664257223597, 0.21659731362923845, -0.09183819886691127, -0.13910527347468582, 0.07303824834474448, -0.11390145782884334, -0.08753946495070704, -0.1208901028714282, -0.022251845712648943, -0.09276126708689864, 0.17235311467306727, 0.28848503183521573, 0.16127368949206133, -0.06511686993974596, -0.01979054652443251, 0.23740525778136123, -0.11860281071300893, -0.21785165433249476, 0.23037433565165139, 0.16525221040733962, -0.06756215563866362, 0.09550198045754146, -0.20862744367827873, 0.14690284662328634, -0.16618442707086725, -0.0814515323257451])
# evaluateGait([5.781788339083582, 191.42080072544792, 0.5688548774344637, 3.9669731679222298, 0.4667308571185266, 0.5224147801682509, 0.5816993644205081, 0.04461560026672717, 0.2921670312891088, 1.0570163167121032, 0.06017852656634881, -0.7062369445777898, -1.908012212416847, -0.958153079710117, 1.147468519002985, 0.7550092464298961, -1.971815189470704, -0.9087387939553773, 0.19102297647113264, 1.0894193593532322, -1.9083003122744908, 2.5301963385929462, 0.7559493602290973, 0.7030098773617931, 0.40209523468775576, 0.4534418852987843, 0.9330169369349677, -0.8946150480594783, 1.3041997722668355, -0.9437057853785603, 0.6270665132391682, -0.2957087361838765, -0.21741258892403703, -1.7684264626353472, -1.147576507326322, 0.4145146124875183, -0.20862477684562775, -1.1661367752962937, -1.6263373382155453, 2.4765495984734733, 0.09123691910372786, 0.9700965096183471, 0.6303484771624478, 0.8394480620803454, 0.8529079309951997, -0.13019628808632877, 0.1973619230491494, -1.361488796153084, 0.15883324640802376, -0.6126325191265922, 1.3458947159758337, -0.7436071728738727, -0.21411091925549408, -1.6237227590492291, 1.7067889459671703, -0.8324050332940264, -0.43667783574674607, 2.256736896076628, 0.6413125886383678, 0.5214047279171137, 0.6844662739383585, 0.35873378082375723, 0.9467896942504543, 1.5790423662282693, 1.066883351847518, 1.6699708052839042, 1.0348212303688618, 0.8680939296644951, 1.555329658651564, 1.2169993959762153, 0.005994513541726421, 1.8268116783859014, 1.1861192471457187, -1.175478500732274, -1.500695900891491, 0.6111470755290194, 0.7847220994266875, 0.8026191036187645, 0.2969236942601957, 0.19980277280036962, 0.6837022959020336, -1.4008999260361035, 1.4761179060047165, -1.7310621091823037, -0.8802568080229077, -1.3924502813753574, 1.0062899799701834, 1.0897825800097278, 1.6535621227954937, 0.8996689895350798, -0.5797842488110526, -1.6939776824588155, 1.2650469019587343, 3.9953062669432273, 0.2564319958767083, 0.6854422094579308, 0.8785911528745154, 0.788773531781406, 0.007230018840243102, -1.8574486160494523, -0.38996259401102096, -0.005438782018124569, -0.9797646373800465, 0.23673783573408647, -0.8153300068102296, 1.4039952885173292, -1.6501951411532292, -0.24636083554015303, 0.9056767053735124, -1.7022398902170721, 0.8045512591928179, 1.6435382449432936, 0.9974787832108732, 0.800090084138988, 0.17750729928747178, 0.6133356282333692, 0.6070729354196744, 1.2169381876530208, 0.5129625629778274, 1.4323503470503547, 0.47125140766467644, -1.3972415176018154, -1.9094200651701305, 1.5520624631327433, -0.8553900845863844, -0.03204295007040514, 0.10084211918694182, 1.9081147646532846, -1.6793489558394121, 1.6697421032475175, 0.9569358903142453, 0.5647474757973465, 0.3012127158818308, 0.9169089002654824, 0.10073118681432158, -1.141380403825723, 1.8664974022206877, 0.8333491261371531, 1.1248143933700812, -0.362468446849736, 0.5848638052922324, -0.2982028233100664, 1.6125685375114425, -1.5660391785502723, 1.5186588698080146, 0.6526442714674312, -1.1769833111094243, 2.7289282448440946, 0.7837344039285865, 0.7153849115091522, 0.20912200516426205, 0.3019922428392092, 0.6361839536621468, -0.4393551304353358, 0.5092834971073525, -1.0305447705227226, 1.0139739940638606, -0.9991806436357229, 0.4450116848992436, 1.2693247993846684, 1.7221648836691752, -0.8965453666303702, 0.7900312850749773, 1.547837792734849, -1.852385758171658, 0.4301856309828876, 0.6191071172098818, 0.5922567760778619, 0.7614632425376439, 0.3983833365277992, 0.4448710310598092, -1.668954125086417, -0.31628699368724955, -1.5404585398491535, -0.15485456316355095, -1.069794760561419, -0.8214108325237759, -1.0691063615332448, -1.5376120580046164, 0.5380849031413051, 1.471541450005985, 1.915427098595639, -0.47444241901890755, 1.4026803123616145, 0.6111017693769504, 0.43815333159086634, 0.20965871416876425, 0.3660639453743723, 0.7230036567541327, 0.6752602172099773, -0.9457797955474354, -0.4982892936407641, -0.1894880426119383, 1.1463860802210206, 0.117109623223012, -0.8115841391302929, 0.8093711288396278, -1.06188773950082, -0.05738741227779648, 0.05951257265195675, 1.0138835362100824, 2.8555417388916324, 0.6024247987199822, 0.6617414832690572, 0.4667347016887281, 0.28104806144947314, 0.755748838210431, 0.4263236841332132, 0.946691627764196, -1.5931958302692688, 0.5841211852344945, 1.7014482171156489, 0.3978259370006281, -0.7240091428188147, -1.909520584926823, 1.2499043453605232, 0.2708423333867489, -0.25954779931919403, 1.9822665930839536, 2.511026271303729, 0.012628590218931701, 0.630132059380591, 0.4189355774987392, 0.2848816850906539, 0.034903693416565906, 0.9044539614228236, -1.5900855534464609, -0.9423641243606095, 1.6817440930880063, 1.0788566915099447, -1.166773289699759, -0.8288751799781999, -1.6617620934256012, 0.40770860116448626, 1.15750307241042, 1.4265075150659965, 1.9726510647912636, 2.695076399110309, 0.7223977687085267, 0.8936732677305455, 0.8863409717299091, 0.6436820318968399, 0.9878153750623807, -0.9970387435556054, -0.9290192803270051, 0.3308090818685048, -1.070053057961184, -1.9284099824434011, 0.8125866686887141, -0.47894191134281616, 1.4214736593003634, -0.24374614336704642, 0.7554032148015515, 0.24077518323209124, 1.9965808463694135, 0.24432413201157877, 0.9045967872963583, 0.31568398100313627, 0.43338954976758315, 0.06283390608792161, 0.8163332158651674, -0.279953512503736, 1.9028036175736722, -0.9845757249746891, 1.653425553013209, 0.7123662138018623, 1.890097237036659, 0.7288952405222213, 0.7757902366658731, 1.8433883928094104, 1.3966866000227318, 1.7698367755200937, 1.3231096288329458, 2.520071833968273, 0.9177148960574864, 0.8147150766115588, 0.28638861508273006, 0.6169315665647988, 0.22685386571123445, 0.10923104958725138, 1.1002075047869595, -0.1342454875617886, -1.1988635284991875, 0.2641095715992101, 0.30850140250714153, -1.3670244092147468, -0.8903972320358289, 0.2488647774966305, 0.5717397630159596, -1.384315835095154, -0.013901075211148584, 0.14089693765293232, 0.05251880727783598, 0.5488152932225777, 0.4512896316186638, 0.4589210317827497, 0.1859023384961932, -0.1091057442725283, 1.0279259415277484, 0.5378460563278684, -1.3035527992357174, -0.17859934405022287, -0.1745698671197986, -0.39467702192842485, -1.2467158405373486, 1.9013510487709557, -1.3883561080392997, -1.2900665578569284, 0.6700925096623346, 2.155017052663035, 0.54120045529377, 0.8159442789384974, 0.5089709424723861, 0.3627024733124532, 0.8843614154223178, -1.229564754877217, -0.5607817721060644, 0.695699564305297, -0.3764726434356519, -0.08182845405484118, -0.41002657141166454, -1.5523248147727167, -1.458015812618383, -1.06736474840597, 0.016569704861711276, 0.6957220742464452, -0.024505044147229815, 2.6234220592047226, 0.2689970688693668, 0.06596425581861448, 0.7130086107115617, 0.03115042367636922, 0.33649697508030174, -1.5130466138704786, 1.8442882891020034, -0.3820484565472384, 1.0666017779244343, -1.3551219301484332, 1.6581624673523676, 0.3827734516591448, -0.0689299033699523, -0.1692398612317043, -1.5613942543691124, 0.24646713405917842, 0.9515210135760332, 1.4897965382553124, 0.1282591150264883, 0.4507751072823369, 0.767265281103232, 0.018695029297693233, 0.10862613686120762, -1.5450148038145293, -0.437353152124345, 0.960867357885354, -0.6432485595875099, -1.441570290301142, 1.821033579294761, 0.7660342474984676, -0.8123323492519172, -1.0090083384875514, 1.9644261548750195, 1.8865295554414638, 1.9791499645806425, 1.0342679838873008, 0.7645686315034859, 0.6915583400317048, 0.3307976011345517, 0.24971425261752572, 0.7612239766482258, 0.4379580213716774, 1.4244859092656963, 0.35522566146299833, 0.28868589883880524, 1.449014252640429, 0.9973813325216075, 1.477593731146874, -0.7513285901058824, 1.29413348206071, -0.3963759859485054, 1.1313293578319645, 1.1056352440307644, 3.6208690917001083, 0.056192895353926096, 0.12060865460797598, 0.6930056847914124, 0.23420685010203163, 0.5907304043906471, -0.682095122690983, -1.2184286742638468, -1.1580434122486123, -1.5865409840681175, -1.732497603668448, 0.02971368791912221, -1.3924911372367177, -0.6218354641267861, 0.5796459476949227, 1.716951866686315, 1.746217688116269, -1.8565519912009123, 0.7040845412619707, 0.07255219856026623, 0.9468623120667176, 0.4750463507666031, 0.28910153031578034, 0.687636928819452, -1.9717707211779907, 0.9331540480287601, -1.0027197319281695, 0.32641442276523813, -0.9439264734084509, -0.15114261186136746, 0.4963799438591012, -0.569711211755638, 0.2591357155065075, -1.0533888497184374, 1.778011681044923, -0.7242818697022231, 2.075574289264632, 0.9657495143635022, 0.658708362801407, 0.9946444367832707, 0.1288895052805576, 0.8628022586819172, 1.1201821463840638, -1.0281129674684157, 0.45755865830324294, -0.02004586594252825, -0.6262253336077361, 1.8433752288458594, -0.9869141791500415, 1.2464815041454103, 0.31817567626143806, -1.0377078240599658, 0.44807650196861215, 1.8987019130698992])
# evaluateGait([5.781788339083582, 191.42080072544792, 0.4804053887499487, 3.9669731679222298, 0.46201674674014037, 0.5172458399428121, 0.5816993644205081, 0.04461560026672717, 0.29201321862731044, 1.0570163167121032, 0.06547397347610229, -0.7062369445777898, -1.908012212416847, -0.958153079710117, 1.147468519002985, 0.7550092464298961, -1.971815189470704, -0.9087387939553773, 0.19102297647113264, 1.0851227390635991, -1.9855497591918079, 2.5271496085711807, 0.7559493602290973, 0.7030098773617931, 0.40209523468775576, 0.4534418852987843, 0.9330169369349677, 0.6999302707773221, 1.3041997722668355, -0.9471126954253354, 0.6069419561830459, -0.2957087361838765, -0.21741258892403703, -1.7684264626353472, 1.1400692248191147, 0.4145146124875183, -0.20862477684562775, -1.1964057403391872, -1.5485135752508241, 3.7319856869377155, 0.5230916708302497, 0.8867722387589945, 0.6315502344035548, 0.2360496613080168, 0.22334525411341338, -0.13019628808632877, -0.0867276910202781, -1.361488796153084, 0.15883324640802376, 1.0899256827007484, 1.3458947159758337, -1.2885302741465419, -0.21411091925549408, -1.511862246123324, 1.7067889459671703, -1.7490485326549585, -0.4558785261531681, 1.2750121455063148, 0.40541363892723575, 0.5214047279171137, 0.6844662739383585, 0.3109104102179652, 0.9501459266198583, 1.577808416253149, 1.0712895971857619, 1.6699708052839042, 1.0348212303688618, 0.8886190633037724, 1.555329658651564, 1.2180582197312062, -1.5040957588765422, 1.8268116783859014, 1.1861192471457187, -0.5655888133967518, -0.2521195464259911, 0.6111470755290194, 0.7847220994266875, 0.7994249600436515, 0.5099722827804305, 0.75118348110298, 0.6837022959020336, 1.2628176815769854, 1.5436138823165266, -0.0676369357868708, -0.8802568080229077, -1.3924502813753574, 1.0001903744252767, -0.038382854743104544, -1.3050224753399795, 0.8996689895350798, -0.6505163396635084, -1.6939776824588155, 0.048158530574715974, 3.9953062669432273, 0.25487217941620977, 0.6866657293852293, 0.8785911528745154, 0.788773531781406, 0.02027161910136721, -1.8562216083247767, -0.35963393348534156, -0.00807795139114594, -0.9863062287459946, 0.23673783573408647, -0.8153300068102296, 1.4831437617200858, -0.13820609835039466, -0.26696342047095534, 0.9057714294591517, -1.7022398902170721, 0.8170533941727138, 1.6435382449432936, 0.9974787832108732, 0.800090084138988, 0.17750729928747178, 0.6133356282333692, 0.6070729354196744, 1.2264980929021194, 1.8887491290903724, 1.1689419088490165, 0.47125140766467644, -1.3972415176018154, -1.9477466746986953, 1.5174816261774922, -0.8553900845863844, -0.03204295007040514, 0.26574731809362456, -0.939698881809149, -1.6793489558394121, 1.7551564106433086, 0.967097588362432, 0.5647474757973465, 0.29982263932141967, 0.9011168451855605, 0.09416316183351123, -0.29409324698890665, 1.8080258071786304, 0.8444085391154601, 1.1248143933700812, -0.362468446849736, 0.6495278258443693, -0.2982028233100664, 0.4625688948795712, 1.7432953206725177, 1.6276845251474341, 0.6526442714674312, -1.1769833111094243, 2.7224222986080573, 0.7837344039285865, 0.7153849115091522, 0.17272317526212477, 0.89484719606021, 0.6361839536621468, -0.4393551304353358, 0.5092834971073525, -1.022627604517938, -0.5633022642000376, -1.6590865832733799, 0.4450116848992436, -1.6433371462794908, 1.8103609014481503, -0.8965453666303702, 0.7900312850749773, 1.547837792734849, -1.852385758171658, 0.8632923268607028, 0.6208572728514861, 0.5922567760778619, 0.041162074858117625, 0.3983833365277992, 0.4574191569317101, -1.668954125086417, 0.0927794524390729, -1.5404585398491535, 0.04555832175762878, 1.5469697136553973, -1.7973415571597315, 0.08137373406880916, -1.5376120580046164, 0.5380849031413051, 1.471541450005985, 0.5796177513280698, 1.2070604831446077, 0.3978261143923283, 0.6111017693769504, 0.9882858762184374, 0.20965871416876425, 0.3660639453743723, 0.7230036567541327, 0.6752602172099773, 0.28321756495521444, -0.4982892936407641, -0.1894880426119383, 1.1430609821446311, 0.117109623223012, -0.8115841391302929, 0.8093711288396278, -1.06188773950082, -0.05738741227779648, 0.09296583551258436, -1.0108482818531546, 2.841245884089837, 0.6024247987199822, 0.6617414832690572, 0.2754869938895079, 0.28104806144947314, 0.9422873916552921, 0.4238904687745934, 0.922763593518766, -1.4870936833890955, 0.6152173326393975, 1.8006406119007707, 0.3751422507046194, -0.7240091428188147, -1.909520584926823, 1.2499043453605232, -1.6716072337620593, -0.25954779931919403, 1.98226724346781, 0.8623338339036265, 0.012628590218931701, 0.645874437339564, 0.4177711190862273, 0.2848816850906539, 0.05531009186973654, 0.9054877862706862, -1.5900855534464609, 0.32444552614068356, 1.6817440930880063, 1.0636435609687038, -1.166773289699759, 1.8308532296673348, 1.5901568086708602, 0.38121315197912925, -1.525724566852409, 1.4265075150659965, 1.972694756406492, 2.207374225842785, 0.7223977687085267, 0.8936732677305455, 0.8563314348945864, 0.6454786645706689, 0.9878153750623807, -0.9970387435556054, -0.9290192803270051, 0.2386726101296115, -1.0671083211320207, 1.9251765112648414, 0.8125866686887141, -0.47894191134281616, -0.7327831686489725, -0.24374614336704642, 0.7422114474464351, 0.24077518323209124, 1.9715168850722866, 0.1768165025201034, 0.9045967872963583, 0.31568398100313627, 0.43338954976758315, 0.06332456076238963, 0.8512871121323701, -0.279953512503736, 1.9454310818839275, -0.9845757249746891, 0.006221670157695147, 0.7123662138018623, 1.890097237036659, 0.13613041825515948, 0.8743980418644182, 1.721259111885488, 1.4702382470246365, 1.1044627408717214, 1.3350726392306425, 0.17732210286992234, 0.9194795547407766, 0.8147150766115588, 0.34713737507451603, 0.6107673941126345, 0.2271996284651341, 0.5420328829519565, -1.726718684529791, -0.1342454875617886, -1.1988635284991875, 0.2641095715992101, 0.30850140250714153, -0.633604698672048, -0.8903972320358289, 0.2599323406873777, 0.5517097291572729, -1.3473583536925655, -0.028591413090482076, 1.4010096114241293, 0.05251880727783598, 0.5464190658312974, 0.4512896316186638, 0.47788499658154227, 0.18305699932851427, -0.10569499181605956, 1.0245312090773222, 1.7427192101982012, -1.3035527992357174, -0.13143011878471028, -1.4179596068541611, -0.4896786013742733, -1.2517272319123705, 1.7623480776879101, -1.3883561080392997, -1.1492957225683422, 0.7906943079802823, 2.155017052663035, 0.54120045529377, 0.8159442789384974, 0.5089709424723861, 0.3627024733124532, 0.8843614154223178, 1.8336760305158375, 1.936112476649363, 0.695699564305297, -0.3764726434356519, 0.8231787208623155, -0.4142777436776612, -1.5523248147727167, -1.4569258836615775, -0.9790685521476559, -0.005012571605040095, 0.6355249551973071, 0.00032665504961260083, 2.6234220592047226, 0.8485467679150787, 0.06596425581861448, 0.7130086107115617, 0.03115042367636922, 0.33649697508030174, 0.30745757901013715, 1.777434601367351, -0.3820484565472384, 1.1200158638415227, -1.3551219301484332, 1.473027830006896, 0.3827734516591448, -0.0414518778876396, -0.1692398612317043, -1.5613942543691124, 0.24646713405917842, 0.9508794244215757, 1.4897965382553124, 0.46200433761461546, 0.7817349876011714, 0.767265281103232, 0.018695029297693233, 0.5433127554987833, -1.5450148038145293, -0.437353152124345, 0.961235502236259, -0.6432485595875099, -1.441570290301142, 1.821033579294761, -0.9738462500062687, -0.6883402395104099, -1.0090083384875514, 1.7582656925875797, 1.8865295554414638, 1.9791499645806425, 1.0342679838873008, 0.7645686315034859, 0.6915583400317048, 0.3307976011345517, 0.240548455036389, 0.6061740650324696, 0.4379580213716774, 1.4244859092656963, 0.3560908708081812, 0.5295419846556816, 1.553842252779849, 0.619483824985314, 1.5745422357092982, -1.3520852793245313, -1.8346497397576607, -0.3963759859485054, 1.1364263519430893, -1.0761646962642288, 3.6208690917001083, 0.056192895353926096, 0.12060865460797598, 0.6930056847914124, 0.23049824169392857, 0.5907304043906471, -0.6865431644285813, -1.2184286742638468, -0.6102941493781193, -1.5641707635068816, -1.732497603668448, 0.02971368791912221, -1.3252338522567628, 1.1335129089651694, 0.5796459476949227, 1.716951866686315, 1.2105088536422768, -1.9596836687036605, 3.286373768499307, 0.5103923039403229, 0.16140622631069912, 0.4750463507666031, 0.29547393677908973, 0.9607785880246698, -0.8687418262800946, 0.9331540480287601, -0.351483402305997, 0.32641442276523813, -1.8879571283236638, 0.19215276151338712, 0.4963799438591012, -0.569711211755638, 0.2591357155065075, -1.0533888497184374, 1.778011681044923, -0.7242818697022231, 2.089310672022702, 0.9657495143635022, 0.658708362801407, 0.9946444367832707, 0.0008448363791555696, 0.8628022586819172, 1.13156106469201, -1.0445574932759605, 0.45755865830324294, -0.01982730497854168, -0.6262253336077361, 0.37863229383222496, -0.9869141791500415, 1.2449809077725822, 0.31817567626143806, -1.035438685802633, 1.8409849786288366, 1.8987019130698992])
# evaluateGait(manualChromosomeCreation())
# evaluateGait(manualChromosomeCreation())
# evaluateGait([1.2656174227467702, 237.98822151517712, 0.03479187303557342, 2.9989469860991607, 0.9381890950382538, 0.4680212019215458, 0.12007260980381207, 0.24466016261952184, 0.26184667841992765, 0.14178978084328991, 0.9355322377002296, 1.9371578571699188, 1.5509931461247992, 1.2997929798987962, -0.571557856018473, -1.8141055150161882, -0.4218684051600126, 0.6794129099938573, 1.3875448814469613, -1.3494339946666323, 0.5974880677988643, 2.5839237381176936, 0.2630159449162511, 0.01670867783893132, 0.3427994728761178, 0.7434609079496997, 0.8819193088221636, -1.5455699033618349, -1.999997918112358, 1.254179311390491, 1.2426554444155222, -0.6900938117346282, 1.9324748639315126, 0.9289413696056965, 1.4147395911801923, -1.9979077687056328, 0.6318170568495913, 0.6641354055222422, 1.8702338484863141, 1.9374555591812581, 0.940668095904772, 0.978982319147668, 0.0719760429911327, 0.8802026399733484, 0.4584103672256172, -0.27854813676317025, 0.7194482128363601, -1.5400853634967242, 1.9014716014173105, -0.5527200746321685, -1.3766195832886208, 0.7873122821528984, 1.7163054427194175, -0.9770631810121712, 0.8473160806383664, -0.933286234452439, -1.20323722098514, 0.38417785940145366, 0.07052396829300642, 0.9983564842857071, 0.049518737719796785, 0.658373785870826, 0.8874855610123225, 1.6762423776559086, 1.1745268310141603, 0.9631609618751572, 1.4273305668254015, -0.30488439477657026, 0.3329849255850413, 0.36588686689919697, 1.1632129524330954, 0.15547330397057557, -1.833197147200353, 0.23550174014897216, 0.825070111751281, 2.440038788529799, 0.8417404033498819, 0.30247471858700414, 0.10230604981859717, 0.38140693694289113, 0.19694246687113526, 1.0906176137087582, -0.7357808420253086, -1.8051393305136927, -0.15969796287048993, -1.9959527421092051, -1.48936281010105, -0.309779100926283, -1.985226168078178, 0.8423097048599942, 1.8944121805607972, -1.9052228092665595, -0.6025677461837677, 3.737179385778296, 0.4062671988245006, 0.7338919706740193, 0.20360000477159457, 0.6316976102353419, 0.2092654440926316, 0.08600274742340086, -1.6691923531944175, -1.0511295732756039, -1.2697637889784679, 1.64771395474487, -0.050405463516915994, 1.387981100024004, -0.701831657069356, 1.8197208445305912, -0.45568193815757274, 0.2282059801845287, -0.20148878005053936, 0.3695937616330749, 0.8816160584871555, 0.9933697382111062, 0.6665836559867933, 0.3347907269931845, 0.4443001357930593, -0.5226987727054362, 0.46859791006427853, 1.2067302147424699, -1.8103027450567026, -0.7026339701403006, -1.6440139193223182, 1.7616742808753623, -1.0621344780689983, -1.1224466507949185, 1.2921904641500792, 1.3471183683640806, -1.9139956145720474, 0.05119291204298576, 0.18942486722188423, 0.3471230586003936, 0.40133698950364644, 0.3582277101451309, 0.7636970144907173, 0.31756103789531437, -1.9295508829335586, -1.9294978337103523, -0.9501334272604942, -0.11088334559476987, -1.8001972769293768, 0.9116482050354564, 1.9039690579289887, 1.1780880643086364, 1.6500947739283591, -0.14185188733934356, 1.345170241830879, 0.4995551300151626, 0.4216581686874251, 0.6794006894244962, 0.4588623128067708, 0.8028853000572883, 0.10937163217348289, -0.015325620784497396, -1.2811322291823801, -1.8869831301760933, -1.173926779992719, 0.9595501976989705, -0.9960753317567983, 0.23046390988035537, 0.6573420064617821, 0.9127554839324399, 1.944568826958474, -1.2774560675907565, 0.521728799708824, 2.460403697814874, 0.4153396696645999, 0.7391688058831253, 0.6068537662623068, 0.3231544678509306, 0.39529319821249687, 1.277128892406601, 1.990889151296913, -1.7213762933549486, -1.1973628230690032, -1.8777610139532552, -1.2858812419744503, 0.9557705931037078, 1.453995985249935, 1.4146874730076129, -0.7232340491204934, -1.990072188075033, -0.7359905262577706, 3.3119151919382657, 0.4902774105942806, 0.8892232826051754, 0.574454770257233, 0.9977045195549983, 0.3221438428458194, -1.9522970051863784, 1.6167964092182303, -0.2233464215076757, 0.9810438509653973, 1.9751657380171068, -0.32905391455715005, 0.30564264340660596, 1.69296303496739, 1.2348130929388987, -1.7824882314143469, 1.085168100815272, 1.0883126958028906, 2.6381717898539754, 0.930803331531706, 0.19982069215319298, 0.8141188056931673, 0.14137271246797867, 0.0012408286726619255, 1.7660247014633805, 0.11295940239117475, 0.4672671064233753, -1.997482059211317, 1.9967582584278798, -1.6496699173038176, 0.8545053087890536, 0.40078264110306616, 1.9864810613379829, 0.06797461176544811, 0.7130050260544722, -1.835443832113933, 0.0014414551927736247, 0.0696269213590692, 0.011016262078294509, 0.3686322597831776, 0.6806793701881911, 0.38175340580122363, 1.3448629696859562, -1.4416633615743923, 1.952692260814769, 0.4859382286699043, -1.5840688771066118, -0.7980210878315097, -1.6904797409438574, -0.04212010883783002, -1.1397419710228267, -0.23288738223137093, 1.8791837157663036, -1.7670009864650063, 3.652812512041684, 0.0073205691502184755, 0.6261777991853865, 0.6399854931527496, 0.5454735327630802, 0.46878259796363625, 1.746948507165063, 0.48886799971007133, 1.1730216218666514, 1.9914997908705443, 0.45253441828339686, -1.956798813357406, -0.7433435032088131, -1.6138128944212597, 1.9746043612850535, -1.4544651587919248, -0.4159561023694155, -1.542830015992728, 1.8176387749883522, 0.2107809480537013, 0.6777764239439033, 0.9120100345076971, 0.48270257574573705, 0.7524193108743096, -1.8891764381902196, -1.0303818660541397, -1.587548054464684, -1.1792294453898995, 0.16490896016704593, -0.70106080646585, -1.9759380929333858, 0.5111235155761529, 0.9204272667171358, -0.9901717865708591, -0.7962178912378648, 1.4611576402627913, 0.02064903044059191, 0.8194364388726462, 0.7165757707707839, 0.2634732312889059, 0.9599307991442598, 0.18655611902229732, -1.2328773834151938, 0.5952281526744789, 0.5832596339466879, -1.3234569379873307, 1.9921229590032286, 0.46561648051741955, -0.43968388347113346, 1.5462857633109428, -1.998294344437178, -1.4408107526246003, 1.551179284696051, 1.7985321120986004, 1.7105865485041836, 0.6161876948509322, 0.3067696639488636, 0.22437309407045097, 0.9776247127728985, 0.01025521706704706, 1.6741344609813755, -0.7683936271537084, -0.45491659571237864, 1.0898293519258913, -0.21770165709676248, -1.814004437934279, 1.647394954043121, -1.8728972150815002, -0.36813333066776693, -1.275804968399469, 0.9229659791651261, 0.8962274793376925, 3.743043654071114, 0.9328463468933204, 0.543231576434535, 0.6896288006917011, 0.7757178851412293, 0.5704506692350584, -1.1234629609243605, 1.8120655469842342, 1.0687662064829024, 1.9921011657602692, 1.78684865025656, 0.7192656722955106, 1.234176636925858, 1.112617412101897, 1.8683700614182823, 1.9027400231583858, 0.9396472966785602, -0.9676035968573116, 2.8404958474451445, 0.00880453828559287, 0.5832367238356635, 0.11898987025322288, 0.40478981442609097, 0.2617611238792652, 1.6855200272390165, 0.05574597038533491, 0.717094094097222, -0.3593554283892295, -1.6721079014913292, 0.5596882857553032, 1.8275198860992532, 1.3662732020432378, 0.19820774092656357, -1.4067092739071467, -0.6648729605376047, 0.9389049465859491, 0.2323143850331563, 0.6977578202306056, 0.5862927402455046, 0.45839643184202034, 0.2857288735682981, 0.46257558406769983, 0.3707177587773237, 0.7574088088628869, -0.5580996354070866, -0.2386840819069176, 1.065623043798244, 1.7550389149533785, -0.5200843025128696, -1.2453648056694817, -0.38661721658961323, -1.925353984113924, 0.6382403415504717, -0.06611820461766948, 3.3263871723050418, 0.5942126814727782, 0.24490783457210913, 0.43025537445127543, 0.7526738014198185, 0.9406947304519879, -0.6124540127660316, -1.9744808470465005, -0.48729709579656844, 1.7594039264225614, 0.9440617818726004, 1.000858324304209, 1.2296545447844358, 0.9304729132713728, 1.6960212546055167, -1.052611226915035, -1.3803115633673448, 1.7210507305080551, 0.06702674165167558, 0.3297352176378025, 0.3494994669302887, 0.06433325738109535, 0.008031690989613038, 0.8490916966416784, -0.6875173368943144, 1.940552907611776, -0.08150735706832024, 1.9817793652638205, 0.8540978337214786, 0.7642621731394983, 0.582286705826732, 1.1680346517831734, 0.66735172516987, 1.9243401484549505, -1.3094851193787682, 1.000281158151195, 1.5314118236155008, 0.14121390323135957, 0.9922693301553074, 0.5690726029139811, 0.8368113226442796, 0.4460533941689324, 0.2599636651895405, 1.977511165023137, -0.5857922260774844, -0.025257919921167105, 1.613731883285962, 1.1410603153073193, -0.07843507369892647, 0.1556146278210736, -1.7010085025389985, -0.39022442378585254, -1.6303439583726271, -0.7627506883969959, 0.84932176761426, 0.3568563872561205, 0.9441424169602043, 0.4028617994995263, 0.1454257796508559, 0.4954580052623144, 0.47411925779929187, -1.5486136408702056, -1.727407054883836, 1.4127931894158416, -0.06386978945652833, 1.9181829585949493, 0.15807136876607786, -0.5621570567952723, 1.6971514136709434, 1.7489238231579876, 0.32938549182798316, -0.9200344670337393])
# resetEnvironment()
# p.stepSimulation()
# time.sleep(2)
# p.stepSimulation()
# for i in range(100000):
#     time.sleep(1./240.)
#     p.stepSimulation()


# Genetic Algorithm flow:
def main():
    population = toolbox.populationCreator(n=POPULATION_SIZE)
    stats = tools.Statistics(lambda ind: ind.fitness.values)
    stats.register("max", np.max)
    stats.register("avg", np.mean)
    hof = tools.HallOfFame(HALL_OF_FAME_SIZE)
    population, logbook = elitism.eaSimpleWithElitism(population, toolbox, cxpb=P_CROSSOVER, mutpb=P_MUTATION, ngen=MAX_GENERATIONS, stats=stats, halloffame=hof, verbose=True)
    best = hof.items[0]
    print("-- Best Individual = ", best)
    print("-- Best Fitness = ", best.fitness.values[0])
    maxFitnessValues, meanFitnessValues = logbook.select("max", "avg")

    # plot statistics:
    sns.set_style("whitegrid")
    plt.plot(maxFitnessValues, color='red')
    plt.plot(meanFitnessValues, color='green')
    plt.xlabel('Generation')
    plt.ylabel('Max / Average Fitness')
    plt.title('Max and Average fitness over Generations')
    plt.show()


if __name__ == "__main__":
    main()

# ssc32.close()  # close port
p.disconnect(physicsClient)
